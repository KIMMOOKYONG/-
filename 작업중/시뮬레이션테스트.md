```
!pip install pint
!pip install modsimpy
!pip install yfinance

```

```python
from modsim import *
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import yfinance as yf

```

```python
#----------------------------
# function that will create a dataframe for a single stock
# create_stock_df("GOOG", "2022-01-01", "2022-12-31", 20)
#----------------------------
def create_stock_df(stock, start, end, SMA):

    df = yf.download(stock, start = start, end = end, progress = False)

    df["day"] = range(1, len(df) + 1) # +1을하는 이유는 시작번호가 1로 시작하기 때문이다.
    df["stock"] = stock
    df["SMA_x"] = df.iloc[:,4].rolling(window=SMA).mean()
    df["shifted_close"] = df["Close"].shift(1)
    df["close_difference"] = df["Close"] - df["shifted_close"]
    df = df.reset_index()

    return df

```
![image](https://user-images.githubusercontent.com/102650331/186828637-1bc7b7ea-4af9-41fc-bfd4-79e80595aa2e.png)

```python
#----------------------------
# function to plot the stock dataframe's closing prices
# plot_stock_price(df)
#----------------------------
def plot_stock_price(df):
    x = df["Date"]
    y = df["Close"]
    plt.plot(x, y)

    plt.xlabel("date")
    plt.ylabel("price/share")
    plt.xticks(rotation=70)
    plt.title("stock price over time")
    plt.show()

```
![image](https://user-images.githubusercontent.com/102650331/186828695-90612b18-59a9-401a-8003-c481686a911d.png)

```python
#----------------------------
# create a function that defines a state object
# for financial information that will change during simulation
# input your:
# 1. total dollars to invest
# 2. your entry signal in days
# 3. your exit signal (based on N, i.e. .5N)
# create_state_object(5_000_000, 55, 1)
#----------------------------
def create_state_object(dollars, entry, exit):
    return State(
        dollars = dollars,
        share = 0,
        total_value = dollars,
        x_day_high = 0,
        x_day_low = 0,
        current_price = 0,
        ATR = 0,
        SMA_x = 0,
        x = entry,
        exit_x = exit,
        status = "out",
        entry_price = 0,
        exit_price = 0
    )

```
![image](https://user-images.githubusercontent.com/102650331/186829513-83eff2e4-f2dd-4987-8dce-09f5cdee73f1.png)

```python
#----------------------------
# function that will create a system of parameters (that will not change during simulation)
# make_system(df, state, 5_000_000, 0.1, 0.5)
#----------------------------
def make_system(df, state, starting_dollars, unit_size, add_unit_signal):
    return System(
        t_0 = get_first_label(df),
        t_end = get_last_label(df),
        starting_dollars = starting_dollars,
        unit_size = starting_dollars * unit_size,
        add_unit_signal = add_unit_signal,
        entry_signal = state.x,
        exit_signal = state.exit_x,
        stock = get_first_value(df["stock"]),
        financials = state
    )

```
![image](https://user-images.githubusercontent.com/102650331/186850770-17bd924c-d1bf-48e8-8538-392a3a375e11.png)

